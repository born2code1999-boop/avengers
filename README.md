# Ticketon Watcher (Telegram alerts)

**Что делает:** запускает headless-браузер (Playwright), периодически открывает страницы Ticketon и оф.сайта ФК «Кайрат», ищет по ключевым словам (например, «Кайрат», «Реал», «ЛЧ») и, если находит новые события/ссылки, присылает уведомление в Telegram.

> ⚠️ Это *только уведомления*. Автоматическое бронирование/покупка может нарушать правила сайта и обычно блокируется очередями, антибот-защитой и капчами.

## Быстрый старт

1) Установите Node.js 18+ и Chromium зависимости (Playwright скачает браузеры сам).
2) Скачайте проект и установите зависимости:
```bash
npm i
```
3) Создайте бота в Telegram через **@BotFather**, получите `TELEGRAM_BOT_TOKEN`.
4) Узнайте `TELEGRAM_CHAT_ID` (например, напишите что-нибудь боту и используйте @userinfobot, либо добавьте бота в свой приватный канал и используйте его id).
5) Скопируйте `.env.example` в `.env` и заполните поля.
6) Запуск:
```bash
npm start
```
По умолчанию проверка идёт каждые 60 секунд. Изменить можно через `CHECK_INTERVAL_SEC`.

### Одноразовый запуск (под cron)
```bash
npm run oneshot
```
или
```bash
ONE_SHOT=true node index.js
```

## Настройка поиска

- `KEYWORDS` — список ключевых слов через запятую. Добавьте/уберите варианты (например, «Real Madrid», «Real», «Madrid» и т.д.).
- `URLS` — список страниц для мониторинга. По умолчанию добавлены:
  - `https://ticketon.kz/sports/futbolniy-klub-kairat`
  - `https://ticketon.kz/almaty`
  - `https://ticketon.kz/sports`
  - `https://fckairat.com/`

Смело добавляйте другие релевантные разделы Ticketon (конкретные страницы спорта/футбола/города).

## Где запускать

- Локально или на сервере (PM2, Docker, systemd, cron).
- Пример с **PM2**:
```bash
pm2 start npm --name ticketon-watcher -- start
pm2 save
pm2 startup
```
- Пример с **cron** (каждые 2 минуты):
```cron
*/2 * * * * cd /path/to/ticketon-watcher && /usr/bin/env ONE_SHOT=true /usr/bin/node index.js >> watcher.log 2>&1
```

## Ограничения и советы

- Ticketon может использовать «комнату ожидания», капчи и антибот-механику. Скрипт **не** обходит защиту и предназначен только для уведомлений.
- Лучше заранее:
  - Зайти в аккаунт Ticketon и сохранить платёжные данные (если доступно).
  - Авторизоваться в мобильном приложении Ticketon и у клуба (ФК «Кайрат»), включить пуши.
  - Подписаться на соцсети клуба и рассылки — часто анонсы там раньше всех.
- Если контент на странице рендерится динамически, Playwright уже это учитывает. Если страница совсем пустая, увеличьте таймауты.

## Безопасность/правила

Уважайте **публичную оферту**/правила Ticketon и клубов. Любая попытка автоматизировать покупку и обход ограничений/капч может противоречить правилам и привести к блокировке аккаунта.
